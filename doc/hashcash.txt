для антиспама:

если из SessionVar уже известно что чел не бот -- перестать что-либо делать.
взять простое число типа p=64541717
Взять рандомное число типа m = 10^9+random(10^9).
Вставить эти числа в html-JS.
Заставить JS искать такую степень x, начиная с 100, что p^x (mod m) < 1000
отправить эту степень x на сервер. На сервере быстрым возведением в степень проверить что всё правильно. Проверить что 100 < x < 10^7
прописать в SessionVar что всё окей

не забыть добавить на страницу ворнинг при отключенном javascript
